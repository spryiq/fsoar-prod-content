{
    "@context": "\/api\/3\/contexts\/Workflow",
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Reference > For Every Page",
    "aliasName": null,
    "tag": null,
    "description": null,
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "pageCount",
        "totalPageCount",
        "lastpulltime",
        "current",
        "limit",
        "currentTime",
        "lastPullTimeGlobalVar"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/33f0ab21-60d4-4f9b-8178-a795be8399db",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/e6435ca7-c1f0-4cbd-9a11-9ef70dfef54d",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Check If Output is Empty",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/5c5c3156-bfa7-4b97-a952-92b49895f4ef",
                        "condition": "{{ vars.feedData == None or vars.feedData == \"\" or vars.feedData == null }}",
                        "step_name": "Do Nothing"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/f9d4953a-6254-4371-99ca-2e66131e281e",
                        "step_name": "Create Record In TIM"
                    }
                ],
                "step_variables": []
            },
            "status": null,
            "top": "640",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "b10ba530-df84-4869-b3c8-8340e9976fdc"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "tlp": "White",
                "expiry": 90,
                "tlp_map": "{'Red': {{'TrafficLightProtocol'| picklist('Red') }}, 'Amber': {{'TrafficLightProtocol'| picklist('Amber') }}, 'Green': {{'TrafficLightProtocol'| picklist('Green') }}, 'White': {{'TrafficLightProtocol'| picklist('White') }}}",
                "confidence": 90,
                "pullTimeMacro": "CybleVisionV2LastPullTime_{{vars['audit_info']['cyops_playbook_iri'].split('\/')[-1].replace('-','_')}}",
                "reputation_map": "{'Good': {{'IndicatorReputation'| picklist('Good') }}, 'High': {{'IndicatorReputation'| picklist('Malicious') }}, 'Medium': {{'IndicatorReputation'| picklist('Suspicious') }}, 'TBD': {{'IndicatorReputation'| picklist('TBD') }}, 'No Reputation Available': {{'IndicatorReputation'| picklist('No Reputation Available') }}}",
                "reputationMapping": "{'High':'Malicious',\n'Medium':'Suspicious',\n'Good':'Good'}",
                "indicator_type_map": "{'Domain': {{'ThreatIntelFeedType'| picklist('Domain') }}, 'file:hashes': {{'ThreatIntelFeedType'| picklist('FileHash') }}, 'FileHash-MD5': {{'ThreatIntelFeedType'| picklist('FileHash-MD5') }}, 'FileHash-SHA1': {{'ThreatIntelFeedType'| picklist('FileHash-SHA1') }}, 'FileHash-SHA256': {{'ThreatIntelFeedType'| picklist('FileHash-SHA256') }}, 'IPv4': {{'ThreatIntelFeedType'| picklist('IPv4 Address') }}, 'IPv6': {{'ThreatIntelFeedType'| picklist('IPv6 Address') }}, 'URL': {{'ThreatIntelFeedType'| picklist('URL') }}, 'windows-registry-key': {{'ThreatIntelFeedType'| picklist('Registry') }} ,'Email': {{'ThreatIntelFeedType' | picklist('Email Address') }} }",
                "IndicatorModelTypeMapping": "{ 'IPv4': {{'IndicatorType' | picklist('IP Address') }}, 'IPv6': {{'IndicatorType' | picklist('IP Address') }}, 'Domain': {{'IndicatorType' | picklist('Domain') }}, 'Host': {{'IndicatorType' | picklist('Host') }}, 'URL': {{'IndicatorType' | picklist('URL') }}, 'Port': {{'IndicatorType' | picklist('Port') }}, 'FileHash-MD5': {{'IndicatorType' | picklist('FileHash-MD5') }}, 'File': {{'IndicatorType' | picklist('File') }}, 'FileHash-SHA1': {{'IndicatorType' | picklist(\"FileHash-SHA1\") }}, 'FileHash-SHA256': {{'IndicatorType' | picklist('FileHash-SHA256') }}, 'Email Address': {{'IndicatorType' | picklist('Email Address')}}, 'User':{{'IndicatorType' | picklist('User')}} }",
                "threat_intel_feeds_tLP_map": "{}",
                "indicator_Reputation_Mapping": "{'High':'Malicious',\n'Medium':'Suspicious',\n'Good': 'Good'}",
                "threat_intel_feeds_reputation_map": "{}",
                "threat_intel_feeds_typeOfFeed_map": "{}",
                "Pull_Sample_Incident_in_Past_X_Minutes": "1440"
            },
            "status": null,
            "top": "520",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "05a1e11f-0017-4643-b633-89c73ffb2e1b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Copy of Save Result",
            "description": null,
            "arguments": {
                "lastPullTime": "{{vars.input.params.lastPullTimeGlobalVar}}",
                "currentPullTime": "{{vars.input.params.currentTime}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "3618cdc7-329f-4d45-8d08-bcc56d737036"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Feed List",
            "description": null,
            "arguments": {
                "feedData": "{{vars.steps.Fetch_Indicators_Per_Page.data.data.iocs}}"
            },
            "status": null,
            "top": "400",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "1e2407fc-f889-4f36-ad55-e63cdf64977a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Record In TIM",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.feedData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "value": "{{vars.item.ioc}}",
                    "source": "Cyble Vision V2",
                    "lastSeen": "{{arrow.utcnow().int_timestamp}}",
                    "__replace": "true",
                    "reputation": "{{vars.item.confidence_rating | resolveRange(vars.reputation_map)}}",
                    "sourceData": "{{vars.item}}",
                    "typeOfFeed": "{{vars.item.ioc_type | resolveRange(vars.indicator_type_map)}}",
                    "__fieldsToUpdate": [
                        "lastSeen",
                        "reputation"
                    ]
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/threat_intel_feeds",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite",
                    "threatTypes": "Overwrite",
                    "killChainPhases": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "760",
            "left": "1120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "f9d4953a-6254-4371-99ca-2e66131e281e"
        },
        {
            "@type": "WorkflowStep",
            "name": "Do Nothing",
            "description": null,
            "arguments": {
                "params": [],
                "version": "3.4.0",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
            },
            "status": null,
            "top": "760",
            "left": "800",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "5c5c3156-bfa7-4b97-a952-92b49895f4ef"
        },
        {
            "@type": "WorkflowStep",
            "name": "Fetch Indicators Per Page",
            "description": null,
            "arguments": {
                "name": "Cyble Vision V2",
                "config": "2c4fb254-6427-46c1-9a05-ef18a64c478a",
                "params": {
                    "ioc": "",
                    "page": "{{vars.input.params.pageCount}}",
                    "tags": "",
                    "limit": "{{vars.input.params.limit}}",
                    "order": "Ascending",
                    "sortBy": "",
                    "endDate": "{{vars.input.params.current}}",
                    "iocType": "",
                    "sources": "",
                    "startDate": "{{vars.input.params.lastpulltime}}",
                    "confidentRating": "High",
                    "riskRating[gte]": 100,
                    "riskRating[lte]": 75
                },
                "version": "1.0.0",
                "connector": "cyble-vision-v2",
                "operation": "fetch_indicators",
                "operationTitle": "Fetch Indicators",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "280",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "14fe0951-50d7-4416-b644-ac3c930ec063"
        },
        {
            "@type": "WorkflowStep",
            "name": "Page Details",
            "description": null,
            "arguments": {
                "total": "{{vars.input.params.totalPageCount}}",
                "pageNumber": "{{vars.input.params.pageCount}}"
            },
            "status": null,
            "top": "160",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "91106516-010e-4f75-b315-07b98da2a08a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Reference Create Record in TIM",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.feedData}}",
                    "__bulk": false,
                    "parallel": true,
                    "condition": ""
                },
                "arguments": {
                    "sourceData": "{{vars.item}}",
                    "indicatorType": "{{vars.item.ioc_type}}",
                    "indicatorValue": "{{vars.item.ioc}}",
                    "indicatorReputation": "{{vars.item.confidence_rating}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/0059c898-d027-4ea0-8c05-4efe7a284963"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "392d7caf-6898-4c11-8db8-a4f975abf752"
        },
        {
            "@type": "WorkflowStep",
            "name": "Save Result",
            "description": null,
            "arguments": {
                "lastPullTime": "{{vars.input.params.lastPullTimeGlobalVar}}",
                "currentPullTime": "{{vars.input.params.currentTime}}"
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "afcf7073-035d-4ba3-bdc1-402eeeddcc7a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "__triggerLimit": true,
                "step_variables": {
                    "input": {
                        "params": []
                    }
                },
                "triggerOnSource": true,
                "triggerOnReplicate": false
            },
            "status": null,
            "top": "40",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "e6435ca7-c1f0-4cbd-9a11-9ef70dfef54d"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Check If Output is Empty -> Create Record In TIM 1",
            "targetStep": "\/api\/3\/workflow_steps\/f9d4953a-6254-4371-99ca-2e66131e281e",
            "sourceStep": "\/api\/3\/workflow_steps\/b10ba530-df84-4869-b3c8-8340e9976fdc",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "55e48290-a9b5-4c09-91ca-aab139d5a524"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Check If Output is Empty -> Do Nothing",
            "targetStep": "\/api\/3\/workflow_steps\/5c5c3156-bfa7-4b97-a952-92b49895f4ef",
            "sourceStep": "\/api\/3\/workflow_steps\/b10ba530-df84-4869-b3c8-8340e9976fdc",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "24b76007-884e-4367-b3ce-e23aeaad11a8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Check If Output is Empty",
            "targetStep": "\/api\/3\/workflow_steps\/b10ba530-df84-4869-b3c8-8340e9976fdc",
            "sourceStep": "\/api\/3\/workflow_steps\/05a1e11f-0017-4643-b633-89c73ffb2e1b",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "f318a2e8-9ab8-4a0d-852c-5ca64d28748d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> cyble",
            "targetStep": "\/api\/3\/workflow_steps\/14fe0951-50d7-4416-b644-ac3c930ec063",
            "sourceStep": "\/api\/3\/workflow_steps\/91106516-010e-4f75-b315-07b98da2a08a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a71cfe78-90e5-4c3d-a788-bde0746e80c2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Copy of Save Result -> Reference Create Record in TIM",
            "targetStep": "\/api\/3\/workflow_steps\/392d7caf-6898-4c11-8db8-a4f975abf752",
            "sourceStep": "\/api\/3\/workflow_steps\/3618cdc7-329f-4d45-8d08-bcc56d737036",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "34bf48b8-90f9-46b2-b120-a532bbeebade"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Feed List -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/05a1e11f-0017-4643-b633-89c73ffb2e1b",
            "sourceStep": "\/api\/3\/workflow_steps\/1e2407fc-f889-4f36-ad55-e63cdf64977a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "980c94a0-7e99-47c1-8471-46a3cc2b8584"
        },
        {
            "@type": "WorkflowRoute",
            "name": "cyble -> Create Feed List",
            "targetStep": "\/api\/3\/workflow_steps\/1e2407fc-f889-4f36-ad55-e63cdf64977a",
            "sourceStep": "\/api\/3\/workflow_steps\/14fe0951-50d7-4416-b644-ac3c930ec063",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7c28a819-8013-405d-ae43-47f3d85f7c42"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Save Result -> Copy of Save Result",
            "targetStep": "\/api\/3\/workflow_steps\/3618cdc7-329f-4d45-8d08-bcc56d737036",
            "sourceStep": "\/api\/3\/workflow_steps\/afcf7073-035d-4ba3-bdc1-402eeeddcc7a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "9c03487f-64ed-498f-b575-e12a8beb1160"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/91106516-010e-4f75-b315-07b98da2a08a",
            "sourceStep": "\/api\/3\/workflow_steps\/e6435ca7-c1f0-4cbd-9a11-9ef70dfef54d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7ed350f5-d47b-477f-8382-55c8cd403ad0"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "playbookOrigin": "\/api\/3\/picklists\/15c1e8c9-22bf-4e66-8fbb-0a502d4a4a3f",
    "isEditable": true,
    "uuid": "faa65f89-b2e7-4043-a8be-a6de5681a636",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": []
}